(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{525:function(v,_,e){"use strict";e.r(_);var r=e(6),t=Object(r.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"js-引擎的异步机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js-引擎的异步机制"}},[v._v("#")]),v._v(" JS 引擎的异步机制")]),v._v(" "),e("ul",[e("li",[e("p",[e("code",[v._v("JavaScript")]),v._v(" 引擎是"),e("strong",[v._v("单线程运行的")]),v._v(",浏览器无论在什么时候都只且"),e("strong",[v._v("只有一个线程在运行")]),v._v(" "),e("code",[v._v("JavaScript")]),v._v(" 程序。")])]),v._v(" "),e("li",[e("p",[v._v("浏览器的"),e("strong",[v._v("内核是多线程的")]),v._v("，它们在内核控制下相互配合以"),e("strong",[v._v("保持同步")]),v._v("。")]),v._v(" "),e("ul",[e("li",[v._v("一个浏览器至少实现"),e("strong",[v._v("三个常驻线程")]),v._v("："),e("code",[v._v("JavaScript")]),v._v(" 引擎线程，"),e("code",[v._v("GUI")]),v._v(" 渲染线程，浏览器事件触发线程。\n"),e("ul",[e("li",[e("code",[v._v("JavaScript")]),v._v(" 引擎是基于"),e("strong",[v._v("事件驱动单线程执行")]),v._v("的，"),e("code",[v._v("JavaScript")]),v._v(" 引擎一直等待着"),e("strong",[v._v("任务队列")]),v._v("中任务的到来，然后加以处理，浏览器"),e("strong",[v._v("无论什么时候")]),v._v("都只有一个 "),e("code",[v._v("JavaScript")]),v._v(" 线程在运行 "),e("code",[v._v("JavaScript")]),v._v(" 程序。")]),v._v(" "),e("li",[e("code",[v._v("GUI")]),v._v(" 渲染线程负责"),e("strong",[v._v("渲染浏览器界面")]),v._v("，当界面发生重绘"),e("code",[v._v("（Repaint）")]),v._v("或回流"),e("code",[v._v("(Reflow)")]),v._v("时,该线程就会执行。但需要注意，"),e("code",[v._v("GUI")]),v._v(" 渲染线程与 "),e("code",[v._v("JavaScript")]),v._v(" 引擎是"),e("strong",[v._v("互斥")]),v._v("的，当 "),e("code",[v._v("JavaScript")]),v._v(" 引擎执行时 "),e("code",[v._v("GUI")]),v._v(" 线程会被挂起，"),e("code",[v._v("GUI")]),v._v(" 更新会被保存在一个队列中等到 "),e("code",[v._v("JavaScript")]),v._v(" 引擎空闲时立即被执行。")]),v._v(" "),e("li",[v._v("事件触发线程，当一个事件被触发时该线程会把事件添加到"),e("strong",[v._v("待处理队列的队尾")]),v._v("，等待 "),e("code",[v._v("JavaScript")]),v._v(" 引擎的处理。这些事件可来自 "),e("code",[v._v("JavaScript")]),v._v(" 引擎当前执行的代码块如 "),e("code",[v._v("setTimeout")]),v._v("、也可来自浏览器内核的其他线程如鼠标点击、"),e("code",[v._v("Ajax")]),v._v(" 异步请求等，但由于 "),e("code",[v._v("JavaScript")]),v._v(" 的单线程关系所有这些事件都得排队等待 "),e("code",[v._v("JavaScript")]),v._v(" 引擎处理（"),e("strong",[v._v("当线程中没有执行任何同步代码的前提下才会执行异步代码")]),v._v("）。")])])])])])]),v._v(" "),e("h2",{attrs:{id:"js-引擎为啥是单线程？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js-引擎为啥是单线程？"}},[v._v("#")]),v._v(" JS 引擎为啥是单线程？")]),v._v(" "),e("ul",[e("li",[v._v("作为浏览器脚本语言，"),e("code",[v._v("JavaScript")]),v._v(" 的主要用途是"),e("strong",[v._v("与用户互动")]),v._v("，以及"),e("strong",[v._v("操作 "),e("code",[v._v("DOM")])]),v._v("。")]),v._v(" "),e("li",[v._v("这决定了它只能是"),e("strong",[v._v("单线程")]),v._v("，否则会带来很复杂的"),e("strong",[v._v("同步问题")]),v._v("。")])]),v._v(" "),e("h2",{attrs:{id:"宏任务-task-、微任务-、event-loop"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#宏任务-task-、微任务-、event-loop"}},[v._v("#")]),v._v(" 宏任务(task)、微任务()、Event-Loop")]),v._v(" "),e("p",[e("img",{attrs:{src:"/images/Event-loop.png",alt:"Event-Loop"}})]),v._v(" "),e("ul",[e("li",[v._v("JS 主线程执行栈(执行空间，无论宏任务还是微任务都在执行栈中执行)\n"),e("ul",[e("li",[v._v("宏任务")])])]),v._v(" "),e("li",[v._v("回调队列（先进先出）\n"),e("ul",[e("li",[v._v("微任务（宏任务的回调函数）")])])]),v._v(" "),e("li",[v._v("宏任务按顺序执行，且浏览器在每个宏任务之间渲染页面")]),v._v(" "),e("li",[v._v("所有微任务也按顺序执行，且在以下场景会立即执行所有微任务\n"),e("ul",[e("li",[v._v("每个回调之后且 js 执行栈中为空。")]),v._v(" "),e("li",[v._v("每个宏任务结束后。")])])]),v._v(" "),e("li",[v._v("Event-Loop\n"),e("ul",[e("li",[v._v("便是一个宏任务的结束与另一个宏任务的开始")])])])]),v._v(" "),e("h2",{attrs:{id:"js-引擎能实现多线程码？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js-引擎能实现多线程码？"}},[v._v("#")]),v._v(" JS 引擎能实现多线程码？")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("Web Worker")]),v._v(" 的作用，就是为 "),e("code",[v._v("JavaScript")]),v._v(" 创造多线程环境，允许主线程创建 "),e("code",[v._v("Worker")]),v._v(" 线程。")])]),v._v(" "),e("h3",{attrs:{id:"web-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-worker"}},[v._v("#")]),v._v(" Web Worker")]),v._v(" "),e("ul",[e("li",[e("strong",[v._v("同源限制")]),v._v(" "),e("ul",[e("li",[v._v("分配给 "),e("code",[v._v("Worker")]),v._v(" 线程运行的脚本文件，必须与主线程的脚本文件同源。")])])]),v._v(" "),e("li",[e("strong",[v._v("DOM 限制")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("Worker")]),v._v(" 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 "),e("code",[v._v("DOM")]),v._v(" 对象，也无法使用 "),e("code",[v._v("document、window、parent")]),v._v(" 这些对象。")]),v._v(" "),e("li",[v._v("但是，"),e("code",[v._v("Worker")]),v._v(" 线程可以 "),e("code",[v._v("navigator")]),v._v(" 对象和 "),e("code",[v._v("location")]),v._v(" 对象。")])])]),v._v(" "),e("li",[e("strong",[v._v("通信联系")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("Worker")]),v._v(" 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。")])])]),v._v(" "),e("li",[e("strong",[v._v("脚本限制")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("Worker")]),v._v(" 线程不能执行 "),e("code",[v._v("alert()")]),v._v("方法和 "),e("code",[v._v("confirm()")]),v._v("方法，但可以使用 "),e("code",[v._v("XMLHttpRequest")]),v._v(" 对象发出 "),e("code",[v._v("AJAX")]),v._v(" 请求。")])])]),v._v(" "),e("li",[e("strong",[v._v("文件限制")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("Worker")]),v._v(" 线程无法读取本地文件，即不能打开本机的文件系统"),e("code",[v._v("（file://）")]),v._v("，它所加载的脚本，必须来自网络。")])])])]),v._v(" "),e("h4",{attrs:{id:"基本用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本用法"}},[v._v("#")]),v._v(" 基本用法")]),v._v(" "),e("ul",[e("li",[v._v("主线程采用"),e("code",[v._v("new")]),v._v("命令，调用 W"),e("code",[v._v("orker()")]),v._v("构造函数，新建一个 "),e("code",[v._v("Worker")]),v._v(" 线程。\n"),e("ul",[e("li",[e("code",[v._v("const worker = new Worker('work.js');")])])])])]),v._v(" "),e("h2",{attrs:{id:"参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[v._v("#")]),v._v(" 参考链接")]),v._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2018/07/web-worker.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("Web Worker 使用教程"),e("OutboundLink")],1)])]),v._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000014940904",target:"_blank",rel:"noopener noreferrer"}},[v._v("译文：JS 事件循环机制（event loop）之宏任务、微任务"),e("OutboundLink")],1)])]),v._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://juejin.im/post/5b73d7a6518825610072b42b#heading-6",target:"_blank",rel:"noopener noreferrer"}},[v._v("微任务、宏任务与 Event-Loop"),e("OutboundLink")],1)])]),v._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.cnblogs.com/zhaodongyu/p/3922961.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("JavaScript 异步机制"),e("OutboundLink")],1)])])])])}),[],!1,null,null,null);_.default=t.exports}}]);